{% extends "base.html" %}

{% block title %}Attractions - Edinburgh Explorer{% endblock %}

{% block content %}
<section class="attractions-container">

  <h1 class="mb-4">Top Attractions in Edinburgh</h1>

  <!-- Search & Filter Controls -->
  <div class="d-flex flex-wrap mb-4 gap-2">
    <input
      type="text"
      id="attractionSearch"
      class="form-control"
      placeholder="Search attractions..."
      style="max-width:300px;"
      aria-label="Search attractions"
    >
    <select
      id="categoryFilter"
      class="form-select"
      style="max-width:200px;"
      aria-label="Filter attractions by category"
    >
      <option value="">All Categories</option>
      <option value="museum">Museum</option>
      <option value="historic">Historic</option>
      <option value="park">Park</option>
      <option value="art">Art</option>
      <option value="landmark">Landmark</option>
    </select>
  </div>

  <!-- Grid layout for displaying attraction cards -->
  <div class="row g-4">
    {% for place in attractions %}
    <div class="col-sm-6 col-md-4 col-lg-3">
      <div class="card h-100 attraction-card" data-category="{{ place.category }}">
        <img
          src="{{ url_for('static', filename='images/' + (place.image if place.image else 'placeholder.jpg')) }}"
          class="card-img-top"
          alt="{{ place.name }} image"
          loading="lazy"
        >
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">{{ place.name }}</h5>
          <p class="card-text">{{ place.description or 'No description available.' }}</p>

          <ul class="list-unstyled mb-2">
            <li><strong>Category:</strong> {{ place.category|capitalize or 'N/A' }}</li>
            <li><strong>Opening Times:</strong> {{ place.opening_times or 'N/A' }}</li>
            <li><strong>Address:</strong> {{ place.address or 'N/A' }}</li>
            <li><strong>Rating:</strong> ‚≠ê {{ place.rating or 'N/A' }}</li>
          </ul>

          {% if place.reviews %}
          <div class="mt-auto">
            <strong>Reviews:</strong>
            <ul class="list-disc ps-3">
              {% for review in place.reviews %}
              <li>{{ review }}</li>
              {% endfor %}
            </ul>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</section>

<!-- Search & Filter Script -->
<script>
function filterAttractions() {
  const searchValue = document.getElementById('attractionSearch').value.toLowerCase();
  const selectedCategory = document.getElementById('categoryFilter').value;
  const cards = document.querySelectorAll('.attraction-card');

  cards.forEach(card => {
    const text = card.innerText.toLowerCase();
    const category = card.getAttribute('data-category');
    const matchesSearch = text.includes(searchValue);
    const matchesCategory = !selectedCategory || category === selectedCategory;
    card.parentElement.style.display = (matchesSearch && matchesCategory) ? '' : 'none';
  });
}

document.getElementById('attractionSearch').addEventListener('input', filterAttractions);
document.getElementById('categoryFilter').addEventListener('change', filterAttractions);
</script>
{% endblock %}
